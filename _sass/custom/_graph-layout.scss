// _sass/custom/_graph-layout.scss

// Variabili (assicurati che siano definite, es. in _variables.scss o qui)
$masthead-height: 40px !default;
$footer-height: 20px !default;
$graph-bg-color: #f1f1f1 !default; // Sfondo per le aree del grafo
$graph-canvas-bg: #ffffff !default; // Sfondo per il canvas del grafo
$resize-handle-width: 8px !default;
$resize-handle-color: #ccc !default;
$resize-handle-hover-color: #aaa !default;

// --- Stili Comuni per Elementi del Grafo (tooltip, legenda) ---
// (Questi sono gli stessi della tua versione precedente, quindi OK)
.graph-node-tooltip {
  position: absolute; 
  background-color: #333;
  color: white;
  padding: 8px 12px;
  border-radius: 4px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  font-size: 0.9em;
  z-index: 1000; // Sopra il canvas
  max-width: 280px;
  pointer-events: none; 
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease, visibility 0s linear 0.2s;

  &.is-visible { opacity: 1; visibility: visible; transition-delay: 0s, 0s; }
  h4 { margin-top: 0; margin-bottom: 5px; font-size: 1.1em; }
  p { margin-bottom: 0; }
}

#graphLegend {
  padding: 10px 15px;
  background-color: rgba(245, 245, 245, 0.95);
  font-size: 0.85em;
  // border-top: 1px solid #ddd; // Aggiungi solo se necessario (es. se sotto il grafo)
  
  h4 { margin-top: 0; margin-bottom: 8px; font-size: 1em; font-weight: bold; }
  ul { list-style: none; padding: 0; margin: 0; }
  li { margin-bottom: 5px; display: flex; align-items: center; }
  .legend-color-swatch { display: inline-block; width: 12px; height: 12px; margin-right: 8px; border: 1px solid #ccc; flex-shrink: 0; }
}


// --- Stili per il Layout della HOMEPAGE (`_layouts/home.html`) ---
#homepage-graph-section {
  width: 100%;
  height: 600px; // Esempio: 75% dell'altezza del viewport
  //min-height: 500px;
  //max-height: 800px;
  background-color: $graph-bg-color; 
  position: relative; 
  display: flex; 
  flex-direction: column; 
  overflow: hidden;
  #graph-container-wrapper {
    flex-grow: .9; 
    position: relative;
    background-color: $graph-canvas-bg;
  }
  #graph-container {
    width: 100%;
    height: 100%;
  }
  #graphLegend { // Legenda sotto il grafo
    border-top: 1px solid #ddd;
  }
}

#homepage-graph-section #graph-container-wrapper {
  flex-grow: 1; 
  position: relative;
  background-color: $graph-canvas-bg;
  // Se l'altezza di homepage-graph-section è fissa, flex-grow dovrebbe funzionare bene
  // Altrimenti, potresti dover dare anche a questo un'altezza fissa per test:
  // height: 580px; // Esempio, un po' meno del genitore per la legenda
  overflow: hidden;
}


#homepage-graph-section #graph-container {
  width: 100%;
  height: 100%; // Dovrebbe ereditare dal wrapper
}

.homepage-additional-content {
  padding: 20px; // Spazio per il contenuto sotto il grafo
}










.archive-layout-with-side-panel {
  display: flex; // Può aiutare, ma non strettamente necessario se la sidebar è position:fixed
  position: relative; // Per posizionare la sidebar se non è fixed al viewport
}

#archive-main-content {
  flex-grow: 1; // Occupa lo spazio disponibile
  // Se la sidebar è fissa a destra, dai un margine destro al contenuto principale
  // per evitare sovrapposizioni.
  transition: margin-right $panel-transition-duration ease-in-out; // Transizione per il margine
  margin-right: $side-panel-width; // Esempio: $graph-sidebar-width: 320px; (vedi _variables.scss)
  padding: 20px; // Padding per il contenuto
  &.panel-is-open {
    // Questo si applica solo se il pannello non è in modalità "overlay" su mobile.
    // Su desktop (pannello fisso a destra che spinge il contenuto):
    @media (min-width: 993px) { // Stesso breakpoint del responsive della sidebar
       margin-right: $graph-sidebar-width;
    }
  }
}

// --- Bottone per il Toggle ---
.toggle-graph-panel-button {
  position: fixed; // Fisso rispetto al viewport
  top: calc(#{$masthead-height} + 20px); // Sotto l'header, con un po' di spazio
  right: 20px; // Distanza dal bordo destro
  z-index: 1001; // Sopra il pannello del grafo ma sotto eventuali menu "burger" del tema
  background-color: #333;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  transition: background-color 0.2s ease, right $panel-transition-duration ease-in-out;

  .icon { display: inline-block; }
  .close-icon { display: none; } // Nascosto di default

  // Stile del bottone quando il pannello è aperto
  &[aria-expanded="true"] {
    // Sposta il bottone a sinistra per rimanere visibile quando il pannello si apre da destra
    right: calc(#{$graph-sidebar-width} + 20px); 
    background-color: #555;
    .open-icon { display: none; }
    .close-icon { display: block; }
  }
}

#graph-side-panel {
  width: $graph-sidebar-width;
  height: calc(100vh - #{$masthead-height}); 
  position: fixed;    
  top: $masthead-height; 
  right: 0;
  background-color: $graph-bg-color;
  border-left: 1px solid #ddd;
  box-shadow: -2px 0 5px rgba(0,0,0,0.08);
  z-index: 1000; // Leggermente sotto il bottone di toggle

  display: flex;
  flex-direction: column;
  overflow: hidden; // Molto importante

  // --- Transizione per l'apertura/chiusura ---
  transform: translateX(100%); // Stato iniziale: chiuso (fuori schermo a destra)
  transition: transform $panel-transition-duration ease-in-out;

  &.is-open {
    transform: translateX(0); // Stato aperto: visibile
  }

  // Contenuto interno del pannello (wrapper grafo, grafo, legenda)
  #graph-container-wrapper {
    flex-grow: 1; 
    position: relative;
    background-color: $graph-canvas-bg;
    overflow: hidden;
  }
  #graph-container {
    width: 100%;
    height: 100%;
  }
}


// --- Responsive per il Side Panel e Bottone ---

#graph-side-panel #graph-container-wrapper {
  flex-grow: 1; // Occupa lo spazio disponibile in altezza nel pannello
  position: relative;
  background-color: $graph-canvas-bg; // Usa la tua variabile
  overflow: hidden; // IMPORTANTE
}

#graph-side-panel #graph-container {
  width: 100%;
  height: 100%;
}

#graph-side-panel #graphLegend {
  border-top: 1px solid #ddd;
  // Stili comuni per la legenda già definiti
}

// --- Responsive per il Side Panel ---
@media (max-width: 992px) { // Esempio di breakpoint (tablet e inferiori)
  #archive-main-content {
    margin-right: 0; // Rimuovi il margine se la sidebar è nascosta o a comparsa
  }

  #graph-side-panel {
    // Su schermi piccoli, puoi:
    // 1. Nasconderla:
    // display: none;

    // 2. Renderla a comparsa con un bottone (più complesso, richiede JS per il toggle)
    // transform: translateX(100%);
    // transition: transform 0.3s ease-in-out;
    // &.is-open {
    //   transform: translateX(0);
    // }

    // 3. Spostarla sotto il contenuto (come avevamo prima per le colonne)
    position: relative; // Non più fixed
    width: 100%;
    height: 60vh; // Altezza specifica per il grafo su mobile
    top: auto;
    right: auto;
    margin-top: 20px; // Spazio dal contenuto
    border-left: none;
    border-top: 1px solid #ddd;
  }

  .archive-layout-with-side-panel {
    // Se sposti la sidebar sotto, il wrapper non ha più bisogno di essere flex,
    // o la sua flex-direction cambia in column
  display: flex;
  position: relative; 
  }
}